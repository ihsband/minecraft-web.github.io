(()=>{var t={948:function(t){(function(){var s,e,n,o,i,r;"undefined"!=typeof performance&&null!==performance&&performance.now?t.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(t.exports=function(){return(s()-i)/1e6},e=process.hrtime,o=(s=function(){var t;return 1e9*(t=e())[0]+t[1]})(),r=1e9*process.uptime(),i=o-r):Date.now?(t.exports=function(){return Date.now()-n},n=Date.now()):(t.exports=function(){return(new Date).getTime()-n},n=(new Date).getTime())}).call(this)},26:(t,s,e)=>{for(var n=e(948),o="undefined"==typeof window?e.g:window,i=["moz","webkit"],r="AnimationFrame",h=o["request"+r],a=o["cancel"+r]||o["cancelRequest"+r],c=0;!h&&c<i.length;c++)h=o[i[c]+"Request"+r],a=o[i[c]+"Cancel"+r]||o[i[c]+"CancelRequest"+r];if(!h||!a){var l=0,u=0,p=[];h=function(t){if(0===p.length){var s=n(),e=Math.max(0,16.666666666666668-(s-l));l=e+s,setTimeout((function(){var t=p.slice(0);p.length=0;for(var s=0;s<t.length;s++)if(!t[s].cancelled)try{t[s].callback(l)}catch(t){setTimeout((function(){throw t}),0)}}),Math.round(e))}return p.push({handle:++u,callback:t,cancelled:!1}),u},a=function(t){for(var s=0;s<p.length;s++)p[s].handle===t&&(p[s].cancelled=!0)}}t.exports=function(t){return h.call(o,t)},t.exports.cancel=function(){a.apply(o,arguments)},t.exports.polyfill=function(t){t||(t=o),t.requestAnimationFrame=h,t.cancelAnimationFrame=a}},963:t=>{const s=/\((-?[.\d]+), (-?[.\d]+), (-?[.\d]+)\)/;class e{constructor(t,s,e){this.x=t,this.y=s,this.z=e}set(t,s,e){return this.x=t,this.y=s,this.z=e,this}update(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}floored(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}offset(t,s,n){return new e(this.x+t,this.y+s,this.z+n)}translate(t,s,e){return this.x+=t,this.y+=s,this.z+=e,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}plus(t){return this.offset(t.x,t.y,t.z)}minus(t){return this.offset(-t.x,-t.y,-t.z)}scaled(t){return new e(this.x*t,this.y*t,this.z*t)}abs(){return new e(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))}volume(){return this.x*this.y*this.z}modulus(t){return new e(o(this.x,t.x),o(this.y,t.y),o(this.z,t.z))}distanceTo(t){var s=t.x-this.x,e=t.y-this.y,n=t.z-this.z;return Math.sqrt(s*s+e*e+n*n)}distanceSquared(t){var s=t.x-this.x,e=t.y-this.y,n=t.z-this.z;return s*s+e*e+n*n}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}toString(){return"("+this.x+", "+this.y+", "+this.z+")"}clone(){return this.offset(0,0,0)}min(t){return new e(Math.min(this.x,t.x),Math.min(this.y,t.y),Math.min(this.z,t.z))}max(t){return new e(Math.max(this.x,t.x),Math.max(this.y,t.y),Math.max(this.z,t.z))}norm(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}unit(){const t=this.norm();return 0===t?this.clone():this.scaled(1/t)}normalize(){const t=this.norm();return 0!==t&&(this.x/=t,this.y/=t,this.z/=t),this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this}xyDistanceTo(t){var s=t.x-this.x,e=t.y-this.y;return Math.sqrt(s*s+e*e)}xzDistanceTo(t){var s=t.x-this.x,e=t.z-this.z;return Math.sqrt(s*s+e*e)}yzDistanceTo(t){var s=t.y-this.y,e=t.z-this.z;return Math.sqrt(s*s+e*e)}innerProduct(t){return this.x*t.x+this.y*t.y+this.z*t.z}manhattanDistanceTo(t){return Math.abs(t.x-this.x)+Math.abs(t.y-this.y)+Math.abs(t.z-this.z)}toArray(){return[this.x,this.y,this.z]}}function n(t,n,o){if(null==t)return new e(0,0,0);if(Array.isArray(t))return new e(parseFloat(t[0],10),parseFloat(t[1],10),parseFloat(t[2],10));if("object"==typeof t)return new e(parseFloat(t.x,10),parseFloat(t.y,10),parseFloat(t.z,10));if("string"==typeof t&&null==n){var i=t.match(s);if(i)return new e(parseFloat(i[1],10),parseFloat(i[2],10),parseFloat(i[3],10));throw new Error("vec3: cannot parse: "+t)}return new e(parseFloat(t,10),parseFloat(n,10),parseFloat(o,10))}function o(t,s){var e=t%s;return e<0?e+s:e}t.exports=n,n.Vec3=e}},s={};function e(n){var o=s[n];if(void 0!==o)return o.exports;var i=s[n]={exports:{}};return t[n].call(i.exports,i,i.exports,e),i.exports}e.n=t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},e.d=(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),e.o=(t,s)=>Object.prototype.hasOwnProperty.call(t,s),(()=>{"use strict";const t=function(t,s){return(+t%(s=+s)+s)%s};class s{constructor(t){this.chunkSize=16,this.chunks={},this.blocksDef=t.blocksDef,this.neighbours={px:[-1,0,0],nx:[1,0,0],ny:[0,-1,0],py:[0,1,0],pz:[0,0,1],nz:[0,0,-1]}}vecToStr(t,s,e){return`${parseInt(t)}:${parseInt(s)}:${parseInt(e)}`}strToVec(t){return t=t.split(":"),[parseInt(t[0]),parseInt(t[1]),parseInt(t[2])]}computeVoxelOffset(s,e,n){const o=0|t(s,this.chunkSize),i=0|t(e,this.chunkSize),r=0|t(n,this.chunkSize);return i*this.chunkSize*this.chunkSize+r*this.chunkSize+o}computeChunkForVoxel(t,s,e){return[Math.floor(t/this.chunkSize),Math.floor(s/this.chunkSize),Math.floor(e/this.chunkSize)]}addChunkForVoxel(t,s,e){const n=this.vecToStr(...this.computeChunkForVoxel(t,s,e));let o=this.chunks[n];return o||(o=new Uint32Array(this.chunkSize*this.chunkSize*this.chunkSize),this.chunks[n]=o),o}getChunkForVoxel(t,s,e){const n=this.vecToStr(...this.computeChunkForVoxel(t,s,e));return this.chunks[n]}setVoxel(t,s,e,n){let o=this.getChunkForVoxel(t,s,e);o||(o=this.addChunkForVoxel(t,s,e)),o[this.computeVoxelOffset(t,s,e)]=n}getVoxel(t,s,e){const n=this.getChunkForVoxel(t,s,e);return n?n[this.computeVoxelOffset(t,s,e)]:0}setChunk(t,s,e,n){this.chunks[this.vecToStr(t,s,e)]=n}getBlock(t,s,e){const n=this.getVoxel(t,s,e),o=this.blocksDef[n];return void 0!==o&&{name:o[0],stateId:n,boundingBox:1===o[1]?"block":"empty",transparent:o[2]}}getBlockNeighbours(t,s,e){const n={},o=this.getBlock(t,s,e);for(const o in this.neighbours){const i=this.neighbours[o];n[o]=this.getBlock(t+i[0],s+i[1],e+i[2])}return[o,n]}intersectsRay(t,s){t.x+=.5,t.y+=.5,t.z+=.5,s.x+=.5,s.y+=.5,s.z+=.5;let e=s.x-t.x,n=s.y-t.y,o=s.z-t.z;const i=e*e+n*n+o*o,r=Math.sqrt(i);e/=r,n/=r,o/=r;let h=0,a=Math.floor(t.x),c=Math.floor(t.y),l=Math.floor(t.z);const u=e>0?1:-1,p=n>0?1:-1,k=o>0?1:-1,x=Math.abs(1/e),d=Math.abs(1/n),f=Math.abs(1/o),g=u>0?a+1-t.x:t.x-a,b=p>0?c+1-t.y:t.y-c,y=k>0?l+1-t.z:t.z-l;let m=x<1/0?x*g:1/0,z=d<1/0?d*b:1/0,M=f<1/0?f*y:1/0,v=-1;for(;h<=r;){const s=this.getBlock(a,c,l);let i;if(i="air"===s.name||"cave_air"===s.name||"void_air"===s.name||"water"===s.name?0:1,i)return{position:[t.x+h*e,t.y+h*n,t.z+h*o],normal:[0===v?-u:0,1===v?-p:0,2===v?-k:0],voxel:i};m<z?m<M?(a+=u,h=m,m+=x,v=0):(l+=k,h=M,M+=f,v=2):z<M?(c+=p,h=z,z+=d,v=1):(l+=k,h=M,M+=f,v=2)}return null}reset(){this.chunks={}}}const n={water:function(t,s,e){const n=this.chunkTerrain.getBlock(e[0],e[1],e[2]);if(10==n.stateId-32)for(const n in this.neighbours){const o=this.neighbours[n];"water"!==this.chunkTerrain.getBlock(e[0]+o[0],e[1]+o[1],e[2]+o[2]).name&&this.addFace(t,s,n,e)}else for(const o in this.neighbours){const i=this.neighbours[o];if("water"===this.chunkTerrain.getBlock(e[0]+i[0],e[1]+i[1],e[2]+i[2]).name)continue;const r=this.genBlockFace(o,n,e),h=[];for(let t=-1;t<=1;t++)for(let s=-1;s<=1;s++){const n=this.chunkTerrain.getBlock(e[0]+t,e[1],e[2]+s);"water"===n.name?n.stateId-32==10?h.push(0):h.push((n.stateId-33)/10):"block"===n.boundingBox?h.push(10):h.push(1)}const a=[Math.min(h[0],h[1],h[3],h[4]),Math.min(h[1],h[2],h[4],h[5]),Math.min(h[4],h[5],h[7],h[8]),Math.min(h[3],h[4],h[6],h[7])];switch(o){case"py":r.pos[1]-=a[3],r.pos[4]-=a[0],r.pos[7]-=a[2],r.pos[10]-=a[2],r.pos[13]-=a[0],r.pos[16]-=a[1];break;case"nx":r.pos[7]-=a[2],r.pos[10]-=a[2],r.pos[16]-=a[3];break;case"px":r.pos[7]-=a[0],r.pos[10]-=a[0],r.pos[16]-=a[1];break;case"nz":r.pos[7]-=a[3],r.pos[10]-=a[3],r.pos[16]-=a[0];break;case"pz":r.pos[7]-=a[1],r.pos[10]-=a[1],r.pos[16]-=a[2]}this.ambientOcclusion(n,e,r,o),this.push(t,s,r,this.chunkTerrain.getBlock(...e).transparent)}},grass:function(t,s,e){const n=this.getUV("grass"),o={pos:[-.4+e[0],-.5+e[1],.4+e[2],.4+e[0],-.5+e[1],-.4+e[2],-.4+e[0],.4+e[1],.4+e[2],-.4+e[0],.4+e[1],.4+e[2],.4+e[0],-.5+e[1],-.4+e[2],.4+e[0],.4+e[1],-.4+e[2],-.4+e[0],-.5+e[1],-.4+e[2],.4+e[0],-.5+e[1],.4+e[2],-.4+e[0],.4+e[1],-.4+e[2],-.4+e[0],.4+e[1],-.4+e[2],.4+e[0],-.5+e[1],.4+e[2],.4+e[0],.4+e[1],.4+e[2],.4+e[0],-.5+e[1],-.4+e[2],-.4+e[0],-.5+e[1],.4+e[2],-.4+e[0],.4+e[1],.4+e[2],.4+e[0],-.5+e[1],-.4+e[2],-.4+e[0],.4+e[1],.4+e[2],.4+e[0],.4+e[1],-.4+e[2],.4+e[0],-.5+e[1],.4+e[2],-.4+e[0],-.5+e[1],-.4+e[2],-.4+e[0],.4+e[1],-.4+e[2],.4+e[0],-.5+e[1],.4+e[2],-.4+e[0],.4+e[1],-.4+e[2],.4+e[0],.4+e[1],.4+e[2]],norm:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],uv:[...n[0],...n[2],...n[1],...n[1],...n[2],...n[3],...n[0],...n[2],...n[1],...n[1],...n[2],...n[3],...n[2],...n[0],...n[1],...n[2],...n[1],...n[3],...n[2],...n[0],...n[1],...n[2],...n[1],...n[3]],color:[.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1,.1,1,.1]};this.push(t,s,o,!0)},lava:function(t,s,e){const n=this.chunkTerrain.getBlock(e[0],e[1],e[2]);if(9==(14&n.stateId)-1)for(const n in this.neighbours){const o=this.neighbours[n];"lava"!==this.chunkTerrain.getBlock(e[0]+o[0],e[1]+o[1],e[2]+o[2]).name&&this.addFace(t,s,n,e)}else for(const o in this.neighbours){const i=this.neighbours[o];if("lava"===this.chunkTerrain.getBlock(e[0]+i[0],e[1]+i[1],e[2]+i[2]).name)continue;const r=this.genBlockFace(o,n,e),h=[];for(let t=-1;t<=1;t++)for(let s=-1;s<=1;s++){const n=this.chunkTerrain.getBlock(e[0]+t,e[1],e[2]+s);"lava"===n.name?(14&n.stateId)-1==10?h.push(0):h.push(((14&n.stateId)-1)/10):"block"===n.boundingBox?h.push(10):h.push(1)}const a=[Math.min(h[0],h[1],h[3],h[4]),Math.min(h[1],h[2],h[4],h[5]),Math.min(h[4],h[5],h[7],h[8]),Math.min(h[3],h[4],h[6],h[7])];switch(o){case"py":r.pos[1]-=a[3],r.pos[4]-=a[0],r.pos[7]-=a[2],r.pos[10]-=a[2],r.pos[13]-=a[0],r.pos[16]-=a[1];break;case"nx":r.pos[7]-=a[2],r.pos[10]-=a[2],r.pos[16]-=a[3];break;case"px":r.pos[7]-=a[0],r.pos[10]-=a[0],r.pos[16]-=a[1];break;case"nz":r.pos[7]-=a[3],r.pos[10]-=a[3],r.pos[16]-=a[0];break;case"pz":r.pos[7]-=a[1],r.pos[10]-=a[1],r.pos[16]-=a[2]}this.ambientOcclusion(n,e,r,o),this.push(t,s,r,this.chunkTerrain.getBlock(...e).transparent)}}};class o{constructor(t){this.cellSize=16,this.undefinedBlock="black_shulker_box",this.blocksTex=t.blocksTex,this.blocksMapping=t.blocksMapping,this.chunkTerrain=t.chunkTerrain,this.toxelSize=t.toxelSize,this.q=1/this.toxelSize,this.neighbours={px:[-1,0,0],nx:[1,0,0],ny:[0,-1,0],py:[0,1,0],pz:[0,0,1],nz:[0,0,-1]},this.customRender={};for(const t in n)this.customRender[t]=n[t].bind(this)}getUV(t){let{x:s,y:e}=this.blocksMapping[t];s-=1,e-=1;const n=16/1296,o=48/1296,i=o*s+n,r=1-o*e-o+n,h=i+o-2*n,a=r+o-2*n;return[[i,r],[i,a],[h,r],[h,a]]}getUvForFace(t,s){let e,n,o;if(void 0!==this.blocksTex[t.name]||void 0!==this.blocksTex[String(t.stateId)])if(e=void 0!==this.blocksTex[String(t.stateId)]?this.blocksTex[String(t.stateId)]:this.blocksTex[t.name],void 0!==e.all)n=this.blocksMapping[e.all].x,o=this.blocksMapping[e.all].y;else if(void 0!==e.side){const t={py:"top",ny:"bottom"};void 0!==t[s]?(n=this.blocksMapping[e[t[s]]].x,o=this.blocksMapping[e[t[s]]].y):(n=this.blocksMapping[e.side].x,o=this.blocksMapping[e.side].y)}else n=this.blocksMapping[e[s]].x,o=this.blocksMapping[e[s]].y;else"water"===t.name?(n=this.blocksMapping.water_flow.x,o=this.blocksMapping.water_flow.y):"lava"===t.name?(n=this.blocksMapping.lava_flow.x,o=this.blocksMapping.lava_flow.y):this.blocksMapping[t.name]?(n=this.blocksMapping[t.name].x,o=this.blocksMapping[t.name].y):(n=this.blocksMapping[this.undefinedBlock].x,o=this.blocksMapping[this.undefinedBlock].y);n-=1,o-=1;const i=16/1296,r=48/1296,h=r*n+i,a=1-r*o-r+i,c=h+r-2*i,l=a+r-2*i;return[h,a,c,a,h,l,h,l,c,a,c,l]}genBlockFace(t,s,e){const n=this.getUvForFace(s,t),o=[];for(let s=0;s<6;s++)o.push(...this.neighbours[t]);const i={pz:[0,1,2,3],nx:[1,4,3,5],nz:[4,6,5,7],px:[6,0,7,2],py:[5,7,3,2],ny:[1,0,4,6]}[t],r=[0,1,2,2,1,3],h=[],a=[[-.5,-.5,.5],[.5,-.5,.5],[-.5,.5,.5],[.5,.5,.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,-.5,-.5],[-.5,.5,-.5]];for(let t=0;t<r.length;t++)h.push(a[i[r[t]]][0]+e[0],a[i[r[t]]][1]+e[1],a[i[r[t]]][2]+e[2]);return{pos:h,norm:o,uv:n}}addFace(t,s,e,n){const o=this.chunkTerrain.getBlock(...n),i=this.genBlockFace(e,o,n);this.ambientOcclusion(o,n,i,e),this.push(t,s,i,this.chunkTerrain.getBlock(...n).transparent)}ambientOcclusion(t,s,e,n){const o={};for(let t=-1;t<=1;t++)for(let e=-1;e<=1;e++)for(let n=-1;n<=1;n++)o[`${t}:${e}:${n}`]="block"===this.chunkTerrain.getBlock(s[0]+t,s[1]+e,s[2]+n).boundingBox?1:0;const i={py:[this.aoColor(o["1:1:-1"]+o["0:1:-1"]+o["1:1:0"]),this.aoColor(o["1:1:1"]+o["0:1:1"]+o["1:1:0"]),this.aoColor(o["-1:1:-1"]+o["0:1:-1"]+o["-1:1:0"]),this.aoColor(o["-1:1:1"]+o["0:1:1"]+o["-1:1:0"])],ny:[this.aoColor(o["1:-1:1"]+o["0:-1:1"]+o["1:-1:0"]),this.aoColor(o["1:-1:-1"]+o["0:-1:-1"]+o["1:-1:0"]),this.aoColor(o["-1:-1:1"]+o["0:-1:1"]+o["-1:-1:0"]),this.aoColor(o["-1:-1:-1"]+o["0:-1:-1"]+o["-1:-1:0"])],px:[this.aoColor(o["-1:-1:0"]+o["-1:-1:-1"]+o["-1:0:-1"]),this.aoColor(o["-1:1:0"]+o["-1:1:-1"]+o["-1:0:-1"]),this.aoColor(o["-1:-1:0"]+o["-1:-1:1"]+o["-1:0:1"]),this.aoColor(o["-1:1:0"]+o["-1:1:1"]+o["-1:0:1"])],nx:[this.aoColor(o["1:-1:0"]+o["1:-1:1"]+o["1:0:1"]),this.aoColor(o["1:1:0"]+o["1:1:1"]+o["1:0:1"]),this.aoColor(o["1:-1:0"]+o["1:-1:-1"]+o["1:0:-1"]),this.aoColor(o["1:1:0"]+o["1:1:-1"]+o["1:0:-1"])],pz:[this.aoColor(o["0:-1:1"]+o["-1:-1:1"]+o["-1:0:1"]),this.aoColor(o["0:1:1"]+o["-1:1:1"]+o["-1:0:1"]),this.aoColor(o["0:-1:1"]+o["1:-1:1"]+o["1:0:1"]),this.aoColor(o["0:1:1"]+o["1:1:1"]+o["1:0:1"])],nz:[this.aoColor(o["0:-1:-1"]+o["1:-1:-1"]+o["1:0:-1"]),this.aoColor(o["0:1:-1"]+o["1:1:-1"]+o["1:0:-1"]),this.aoColor(o["0:-1:-1"]+o["-1:-1:-1"]+o["-1:0:-1"]),this.aoColor(o["0:1:-1"]+o["-1:1:-1"]+o["-1:0:-1"])]}[n];if("water"===t.name)for(let t=0;t<4;t++)i[t][0]/=4,i[t][1]/=4;else if("grass_block"===t.name&&"py"===n||t.name.includes("leaves"))for(let t=0;t<4;t++)i[t][0]/=4,i[t][2]/=4;e.color=[...i[0],...i[2],...i[1],...i[1],...i[2],...i[3]]}push(t,s,e,n){n?(t.positions.push(...e.pos),t.normals.push(...e.norm),t.uvs.push(...e.uv),t.colors.push(...e.color)):(s.positions.push(...e.pos),s.normals.push(...e.norm),s.uvs.push(...e.uv),s.colors.push(...e.color))}aoColor(t){return 0===t?[.9,.9,.9]:1===t?[.7,.7,.7]:2===t?[.5,.5,.5]:[.3,.3,.3]}genChunkGeo(t,s,e){const n={positions:[],normals:[],uvs:[],colors:[]},o={positions:[],normals:[],uvs:[],colors:[]};for(let i=0;i<this.cellSize;i++)for(let r=0;r<this.cellSize;r++)for(let h=0;h<this.cellSize;h++){const a=[t*this.cellSize+i,s*this.cellSize+r,e*this.cellSize+h],[c,l]=this.chunkTerrain.getBlockNeighbours(...a);if("block"===c.boundingBox)for(const t in l){const s=l[t];c.transparent?"block"!==s.boundingBox&&this.addFace(o,n,t,a):("block"!==s.boundingBox||s.transparent)&&this.addFace(o,n,t,a)}else this.customRender[c.name]&&this.customRender[c.name](o,n,a)}return n.positions.push(...o.positions),n.normals.push(...o.normals),n.uvs.push(...o.uvs),n.colors.push(...o.colors),n}}var i=e(26),r=e.n(i),h=e(963),a=e.n(h);self.requestAnimationFrame=r();let c=null;class l{constructor(t){this.chunkTerrain=new s({blocksDef:t.blocksDef}),this.chunkMesher=new o({blocksTex:t.blocksTex,blocksMapping:t.blocksMapping,toxelSize:t.toxelSize,chunkTerrain:this.chunkTerrain}),this.neighbours=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],this.chunkNeedsUpdate={},this.generatedChunks={},this.renderRadius=10,this.playerChunk=[0,0,0],this.loop()}distance(t){const s=this.chunkTerrain.strToVec(t),e=a()(...s);return a()(...this.playerChunk).distanceTo(e)}setVoxel(t){this.chunkTerrain.setVoxel(...t);const s=this.chunkTerrain.vecToStr(...c.chunkTerrain.computeChunkForVoxel(t[0],t[1],t[2]));this.chunkNeedsUpdate[s]=!0;for(let s=0;s<this.neighbours.length;s++){const e=this.neighbours[s],n=this.chunkTerrain.vecToStr(...this.chunkTerrain.computeChunkForVoxel(t[0]+e[0],t[1]+e[1],t[2]+e[2]));this.chunkNeedsUpdate[n]=!0}}setChunk(t){this.chunkTerrain.setChunk(t[0],t[1],t[2],t[3]);const s=c.chunkTerrain.vecToStr(t[0],t[1],t[2]);this.chunkNeedsUpdate[s]=!0;for(let s=0;s<this.neighbours.length;s++){const e=this.neighbours[s],n=this.chunkTerrain.vecToStr(t[0]+e[0],t[1]+e[1],t[2]+e[2]);this.chunkNeedsUpdate[n]=!0}}genNearestChunk(){let t="",s=-1,e=!1;for(const n in this.chunkNeedsUpdate){const o=this.distance(n);(-1===s||s>o)&&o<=this.renderRadius&&(e=!0,s=o,t=n)}if(e){const s=this.chunkTerrain.strToVec(t);this.generatedChunks[t]=!0,postMessage({type:"cellGeo",data:{cell:this.chunkMesher.genChunkGeo(...s),info:s,p:performance.now()}}),delete this.chunkNeedsUpdate[t]}}removeChunks(){for(const t in this.generatedChunks)this.distance(t)>this.renderRadius&&(delete this.generatedChunks[t],this.chunkNeedsUpdate[t]=!0,postMessage({type:"removeCell",data:t}))}loop(){this.removeChunks(),this.genNearestChunk(),self.requestAnimationFrame((()=>{this.loop()}))}updateChunksAroundPlayer(t){this.playerChunk=t[0],this.renderRadius=t[1]}}addEventListener("message",(function(t){const s=t.data.type,e=t.data.data;switch(s){case"init":if(c)return;c=new l(e);break;case"setVoxel":c.setVoxel(e);break;case"genChunkGeo":c.genChunkGeo(e);break;case"setChunk":c.setChunk(e);break;case"resetWorld":console.log("RESET WORLD!"),c.chunkTerrain.reset();break;case"updateChunksAroundPlayer":c.updateChunksAroundPlayer(e)}}))})()})();
